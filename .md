# SnagLog App

Frontend PWA for SnagLog - AI-powered snagging reports.

## Tech Stack

- **React 18** + TypeScript
- **Vite** for build tooling
- **Tailwind CSS** for styling
- **Clerk** for authentication
- **Axios** for API requests
- **PWA** - Installable on mobile

## Live URLs

- **App:** https://app.snaglog.co.uk
- **API:** https://api.snaglog.co.uk
- **Landing:** https://snaglog.co.uk

## Project Structure

```
snaglog-app/
├── src/
│   ├── main.tsx              # Entry point
│   ├── App.tsx               # Router + Clerk provider
│   ├── pages/
│   │   ├── Dashboard.tsx     # Report list
│   │   ├── NewReport.tsx     # Photo capture + upload
│   │   └── ReportReview.tsx  # Review, edit, pay, download
│   ├── components/
│   │   └── ...               # Reusable components
│   └── lib/
│       └── api.ts            # Axios instance
├── public/
│   ├── manifest.json         # PWA manifest
│   └── icon.svg              # App icon
├── index.html
├── package.json
├── tailwind.config.js
├── tsconfig.json
└── vite.config.ts
```

## Environment Variables

```env
VITE_API_URL=https://api.snaglog.co.uk
VITE_CLERK_PUBLISHABLE_KEY=pk_live_...
```

**Important:** VITE_ variables are baked in at build time. Changing them requires a full rebuild, not just redeploy.

## Key Pages

### Dashboard (`/`)
- Lists all user's reports
- Shows status (Draft, Review, Complete)
- Links to create new or view existing

### New Report (`/new`)
- Enter property details
- Take photos with native camera (mobile)
- Upload from library (desktop)
- Image compression before upload
- Triggers AI analysis

### Report Review (`/report/:id`)
- View all detected snags
- Edit descriptions, severity, room, trade
- Add notes
- Pay via Stripe (£19.99)
- Download PDF

## PWA Installation

**iOS:**
1. Open Safari → app.snaglog.co.uk
2. Share → Add to Home Screen

**Android:**
1. Open Chrome → app.snaglog.co.uk
2. Menu → Add to Home Screen

## User Flow

### On-Site (Mobile)
1. Sign in with Google
2. Enter property address
3. Take photos of defects
4. AI analyzes each photo
5. Save report

### Back at Office (Desktop)
1. Open same report
2. Review/edit snags
3. Add notes
4. Pay £19.99
5. Download PDF

## Image Compression

Large iPhone photos (5-10MB) are compressed client-side before upload:

```typescript
async function compressImage(file: File): Promise<File> {
  // Resize to max 1920px
  // Convert to JPEG at 80% quality
  // 10MB → ~300KB
}
```

## API Integration

```typescript
// src/lib/api.ts
import axios from 'axios'

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'http://localhost:3001',
  withCredentials: true,
})

// Add Clerk auth token to requests
api.interceptors.request.use(async (config) => {
  const token = await window.Clerk?.session?.getToken()
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

export default api
```

## Local Development

```bash
# Install dependencies
npm install

# Set up environment variables
cp .env.example .env.local
# Edit with your values

# Run development server
npm run dev
```

Opens at http://localhost:5173

## Build & Deploy

```bash
# Build for production
npm run build

# Preview production build
npm run preview
```

**Railway:** Auto-deploys from GitHub main branch.

## Clerk Configuration

Production Clerk requires:
1. Production instance created
2. Domain: app.snaglog.co.uk
3. Google OAuth configured with custom credentials
4. DNS records for clerk.snaglog.co.uk, accounts.snaglog.co.uk

## Styling

Orange color scheme matching landing page:

```css
/* Primary */
from-orange-500 to-orange-600

/* Severity badges */
MAJOR: bg-red-100 text-red-700
MODERATE: bg-yellow-100 text-yellow-700
MINOR: bg-green-100 text-green-700
```

## Troubleshooting

**"Failed to create report"**
- Check VITE_API_URL is correct
- Check API CORS allows app.snaglog.co.uk
- Check browser console for actual error

**White screen on mobile**
- Check for undefined data (add safety checks)
- Clear PWA cache and reinstall

**Photos not uploading**
- Large files may timeout
- Ensure compression is working
- Check R2 bucket permissions

**Old version showing**
- VITE_ changes need full rebuild
- Hard refresh: Cmd+Shift+R
- Or test in incognito

## Related Repos

- **snaglog-api** - Backend API
- **snaglog** - Landing page
